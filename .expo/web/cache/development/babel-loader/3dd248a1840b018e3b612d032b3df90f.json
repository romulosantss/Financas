{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useContext } from 'react';\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { format } from 'date-fns';\nimport { useNavigation } from '@react-navigation/native';\nimport firebase from \"../../services/firebaseConnection\";\nimport { AuthContext } from \"../../contexts/auth\";\nimport Header from \"../../components/Header\";\nimport { Background, Input, SubmitButton, SubmitText } from \"./styles\";\nimport Picker from \"../../components/Picker\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function New() {\n  var navigation = useNavigation();\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      valor = _useState2[0],\n      setValor = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      tipo = _useState4[0],\n      setTipo = _useState4[1];\n\n  var _useContext = useContext(AuthContext),\n      usuario = _useContext.user;\n\n  function handleSubmit() {\n    Keyboard.dismiss();\n\n    if (isNaN(parseFloat(valor)) || tipo === null) {\n      alert('Preencha todos os campos!');\n      return;\n    }\n\n    Alert.alert('Confirmando dados', \"Tipo \" + tipo + \" - Valor: \" + parseFloat(valor) + \" \", [{\n      text: 'Cancelar',\n      style: 'cancel'\n    }, {\n      text: 'Continuar',\n      onPress: function onPress() {\n        return handleAdd();\n      }\n    }]);\n  }\n\n  function handleAdd() {\n    var uid, key, user;\n    return _regeneratorRuntime.async(function handleAdd$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            uid = usuario.uid;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(firebase.database().ref('historico').child(uid).push().key);\n\n          case 3:\n            key = _context.sent;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(firebase.database().ref('historico').child(uid).child(key).set({\n              tipo: tipo,\n              valor: parseFloat(valor),\n              date: format(new Date(), 'dd/MM/yyyy')\n            }));\n\n          case 6:\n            user = firebase.database().ref('users').child(uid);\n            _context.next = 9;\n            return _regeneratorRuntime.awrap(user.once('value').then(function (snapshot) {\n              var saldo = parseFloat(snapshot.val().saldo);\n              tipo === 'despesa' ? saldo -= parseFloat(valor) : saldo += parseFloat(valor);\n              user.child('saldo').set(saldo);\n            }));\n\n          case 9:\n            Keyboard.dismiss();\n            setValor('');\n            navigation.navigate('Home');\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  return _jsx(TouchableWithoutFeedback, {\n    onPress: function onPress() {\n      return Keyboard.dismiss();\n    },\n    children: _jsxs(Background, {\n      children: [_jsx(Header, {}), _jsxs(SafeAreaView, {\n        style: {\n          alignItems: 'center'\n        },\n        children: [_jsx(Input, {\n          placeholder: \"Valor desejado\",\n          keyboardType: \"numeric\",\n          returnKeyType: \"next\",\n          onSubmitEditing: function onSubmitEditing() {\n            return Keyboard.dismiss();\n          },\n          value: valor,\n          onChangeText: function onChangeText(text) {\n            return setValor(text);\n          }\n        }), _jsx(Picker, {\n          onChange: setTipo\n        }), _jsx(SubmitButton, {\n          onPress: handleSubmit,\n          children: _jsx(SubmitText, {\n            children: \"Registrar\"\n          })\n        })]\n      })]\n    })\n  });\n}","map":{"version":3,"sources":["C:/Users/RML-R/Documents/Estudos/app/AppFinancas/src/pages/New/index.js"],"names":["React","useState","useContext","format","useNavigation","firebase","AuthContext","Header","Background","Input","SubmitButton","SubmitText","Picker","New","navigation","valor","setValor","tipo","setTipo","usuario","user","handleSubmit","Keyboard","dismiss","isNaN","parseFloat","alert","Alert","text","style","onPress","handleAdd","uid","database","ref","child","push","key","set","date","Date","once","then","snapshot","saldo","val","navigate","alignItems"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\r\nimport { SafeAreaView, Keyboard, TouchableWithoutFeedback, Alert} from 'react-native';\r\nimport { format } from 'date-fns';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport firebase from '../../services/firebaseConnection';\r\nimport { AuthContext } from '../../contexts/auth';\r\n\r\nimport Header from '../../components/Header';\r\nimport { Background, Input, SubmitButton, SubmitText} from './styles';\r\nimport Picker from '../../components/Picker';\r\n\r\nexport default function New() {\r\n  const navigation = useNavigation();\r\n\r\n const [valor, setValor] = useState('');\r\n const [tipo, setTipo] = useState(null);\r\n const { user: usuario } = useContext(AuthContext);\r\n\r\n function handleSubmit(){\r\n  Keyboard.dismiss();\r\n  if(isNaN(parseFloat(valor)) || tipo === null){\r\n    alert('Preencha todos os campos!');\r\n    return;\r\n  }\r\n\r\n  Alert.alert(\r\n    'Confirmando dados',\r\n    `Tipo ${tipo} - Valor: ${parseFloat(valor)} `,\r\n    [\r\n      {\r\n        text: 'Cancelar',\r\n        style: 'cancel'\r\n      },\r\n      {\r\n        text: 'Continuar',\r\n        onPress: () => handleAdd()\r\n      }\r\n    ]\r\n  )\r\n\r\n }\r\n\r\n\r\n async function handleAdd(){\r\n   let uid = usuario.uid;\r\n\r\n    let key = await firebase.database().ref('historico').child(uid).push().key;\r\n    await firebase.database().ref('historico').child(uid).child(key).set({\r\n      tipo: tipo,\r\n      valor: parseFloat(valor),\r\n      date: format(new Date(), 'dd/MM/yyyy')\r\n    })\r\n\r\n    //Atualizar o nosso saldo\r\n    let user = firebase.database().ref('users').child(uid);\r\n    await user.once('value').then((snapshot)=>{\r\n      let saldo = parseFloat(snapshot.val().saldo);\r\n\r\n      tipo === 'despesa' ? saldo -= parseFloat(valor) : saldo += parseFloat(valor);\r\n\r\n      user.child('saldo').set(saldo);\r\n\r\n    });\r\n    Keyboard.dismiss();\r\n    setValor('');\r\n    navigation.navigate('Home');\r\n\r\n }\r\n\r\n return (\r\n   <TouchableWithoutFeedback onPress={ () => Keyboard.dismiss() }>\r\n   <Background>\r\n       <Header/>\r\n\r\n       <SafeAreaView style={{ alignItems: 'center' }}>\r\n         <Input\r\n         placeholder=\"Valor desejado\"\r\n         keyboardType=\"numeric\"\r\n         returnKeyType=\"next\"\r\n         onSubmitEditing={ () => Keyboard.dismiss() }\r\n         value={valor}\r\n         onChangeText={ (text) => setValor(text) }\r\n         />\r\n         \r\n         <Picker onChange={setTipo}/>\r\n\r\n        <SubmitButton onPress={handleSubmit}>\r\n          <SubmitText>Registrar</SubmitText>\r\n        </SubmitButton>\r\n\r\n       </SafeAreaView>\r\n\r\n   </Background>\r\n   </TouchableWithoutFeedback>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}